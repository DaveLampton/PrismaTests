# Migration `20201204020153-initial`

This migration has been generated by https://github.com/DaveLampton at 12/3/2020, 6:01:53 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."UserRole" AS ENUM ('SUPERADMIN', 'ADMIN', 'USER')

CREATE TABLE "Argument" (
"id" SERIAL,
    "assertionId" INTEGER NOT NULL,
    "sourceId" INTEGER NOT NULL,
    "userId" INTEGER NOT NULL,
    "side" BOOLEAN NOT NULL,
    "text" TEXT NOT NULL,
    "score" DECIMAL(65,30) NOT NULL DEFAULT 50.0,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Assertion" (
"id" SERIAL,
    "text" TEXT NOT NULL,
    "userId" INTEGER NOT NULL,
    "sourceId" INTEGER NOT NULL,
    "score" DECIMAL(65,30) NOT NULL DEFAULT 50.0,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Rating" (
    "userId" INTEGER NOT NULL,
    "argumentId" INTEGER NOT NULL,
    "rating" BOOLEAN NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("userId","argumentId")
)

CREATE TABLE "Representative" (
    "sourceId" INTEGER NOT NULL,
    "userId" INTEGER NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,

    PRIMARY KEY ("sourceId","userId")
)

CREATE TABLE "Source" (
"id" SERIAL,
    "domain" TEXT NOT NULL,
    "score" DECIMAL(65,30) NOT NULL DEFAULT 50.0,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "User" (
"id" SERIAL,
    "name" TEXT NOT NULL,
    "email" TEXT NOT NULL,
    "password" TEXT NOT NULL,
    "role" "UserRole" NOT NULL DEFAULT E'USER',
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "Source.domain_unique" ON "Source"("domain")

CREATE UNIQUE INDEX "User.email_unique" ON "User"("email")

ALTER TABLE "Argument" ADD FOREIGN KEY("assertionId")REFERENCES "Assertion"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Argument" ADD FOREIGN KEY("sourceId")REFERENCES "Source"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Argument" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Assertion" ADD FOREIGN KEY("sourceId")REFERENCES "Source"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Rating" ADD FOREIGN KEY("argumentId")REFERENCES "Argument"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Rating" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Representative" ADD FOREIGN KEY("sourceId")REFERENCES "Source"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Representative" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201204020153-initial
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,88 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+model Argument {
+  id          Int       @id @default(autoincrement())
+  assertionId Int
+  sourceId    Int
+  userId      Int
+  side        Boolean
+  text        String
+  score       Float     @default(50.0)
+  createdAt   DateTime  @default(now())
+  updatedAt   DateTime  @updatedAt
+  assertion   Assertion @relation(fields: [assertionId], references: [id])
+  source      Source    @relation(fields: [sourceId], references: [id])
+  contributor User      @relation(fields: [userId], references: [id])
+  ratings     Rating[]
+}
+
+model Assertion {
+  id        Int        @id @default(autoincrement())
+  text      String
+  userId    Int
+  sourceId  Int
+  score     Float      @default(50.0)
+  createdAt DateTime   @default(now())
+  updatedAt DateTime   @updatedAt
+  source    Source     @relation(fields: [sourceId], references: [id])
+  arguments Argument[]
+}
+
+model Rating {
+  userId     Int
+  argumentId Int
+  rating     Boolean
+  createdAt  DateTime @default(now())
+  updatedAt  DateTime @updatedAt
+  argument   Argument @relation(fields: [argumentId], references: [id])
+  user       User     @relation(fields: [userId], references: [id])
+
+  @@id([userId, argumentId])
+}
+
+model Representative {
+  sourceId  Int
+  userId    Int
+  createdAt DateTime  @default(now())
+  source    Source    @relation(fields: [sourceId], references: [id])
+  user      User      @relation(fields: [userId], references: [id])
+
+  @@id([sourceId, userId])
+}
+
+model Source {
+  id              Int               @id @default(autoincrement())
+  domain          String            @unique
+  score           Float             @default(50.0)
+  createdAt       DateTime          @default(now())
+  updatedAt       DateTime          @updatedAt
+  arguments       Argument[]
+  assertions      Assertion[]
+  representatives Representative[]
+}
+
+model User {
+  id              Int               @id @default(autoincrement())
+  name            String
+  email           String            @unique
+  password        String
+  role            UserRole          @default(USER)
+  createdAt       DateTime          @default(now())
+  updatedAt       DateTime          @updatedAt
+  arguments       Argument[]
+  ratings         Rating[]
+  represents      Representative[]
+}
+
+enum UserRole {
+  SUPERADMIN
+  ADMIN
+  USER
+}
```


