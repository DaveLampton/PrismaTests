# Migration `20201205203507-initial`

This migration has been generated by https://github.com/DaveLampton at 12/5/2020, 12:35:07 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."UserRole" AS ENUM ('SUPERADMIN', 'ADMIN', 'USER')

CREATE TABLE "Assertion" (
"id" SERIAL,
    "urlToken" TEXT NOT NULL,
    "userId" INTEGER NOT NULL,
    "sourceId" INTEGER NOT NULL,
    "score" DECIMAL(65,30) NOT NULL DEFAULT 50.0,
    "text" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Argument" (
"id" SERIAL,
    "assertionId" INTEGER NOT NULL,
    "sourceId" INTEGER NOT NULL,
    "userId" INTEGER NOT NULL,
    "side" BOOLEAN NOT NULL,
    "score" DECIMAL(65,30) NOT NULL DEFAULT 50.0,
    "text" TEXT NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Rating" (
    "userId" INTEGER NOT NULL,
    "argumentId" INTEGER NOT NULL,
    "rating" BOOLEAN NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("userId","argumentId")
)

CREATE TABLE "Source" (
"id" SERIAL,
    "domain" TEXT NOT NULL,
    "score" DECIMAL(65,30) NOT NULL DEFAULT 50.0,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "User" (
"id" SERIAL,
    "name" TEXT NOT NULL,
    "email" TEXT NOT NULL,
    "passwordHash" TEXT NOT NULL,
    "role" "UserRole" NOT NULL DEFAULT E'USER',
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "_SourceToUser" (
    "A" INTEGER NOT NULL,
    "B" INTEGER NOT NULL
)

CREATE UNIQUE INDEX "Assertion.urlToken_unique" ON "Assertion"("urlToken")

CREATE UNIQUE INDEX "Source.domain_unique" ON "Source"("domain")

CREATE UNIQUE INDEX "User.email_unique" ON "User"("email")

CREATE UNIQUE INDEX "_SourceToUser_AB_unique" ON "_SourceToUser"("A", "B")

CREATE INDEX "_SourceToUser_B_index" ON "_SourceToUser"("B")

ALTER TABLE "Assertion" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Assertion" ADD FOREIGN KEY("sourceId")REFERENCES "Source"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Argument" ADD FOREIGN KEY("assertionId")REFERENCES "Assertion"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Argument" ADD FOREIGN KEY("sourceId")REFERENCES "Source"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Argument" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Rating" ADD FOREIGN KEY("argumentId")REFERENCES "Argument"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Rating" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_SourceToUser" ADD FOREIGN KEY("A")REFERENCES "Source"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_SourceToUser" ADD FOREIGN KEY("B")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201205203507-initial
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,92 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+model Assertion {
+  id              Int             @id @default(autoincrement())
+  urlToken        String          @unique
+  userId          Int
+  sourceId        Int
+  score           Float           @default(50.0)
+  text            String
+  createdAt       DateTime        @default(now())
+  updatedAt       DateTime        @updatedAt
+  representative  User            @relation(fields: [userId], references: [id])
+  source          Source          @relation(fields: [sourceId], references: [id])
+  arguments       Argument[]
+}
+
+model Argument {
+  id          Int       @id @default(autoincrement())
+  assertionId Int
+  sourceId    Int
+  userId      Int
+  side        Boolean
+  score       Float     @default(50.0)
+  text        String
+  createdAt   DateTime  @default(now())
+  updatedAt   DateTime  @updatedAt
+  assertion   Assertion @relation(fields: [assertionId], references: [id])
+  source      Source    @relation(fields: [sourceId], references: [id])
+  contributor User      @relation(fields: [userId], references: [id])
+  ratings     Rating[]
+}
+
+model Rating {
+  userId     Int
+  argumentId Int
+  rating     Boolean
+  createdAt  DateTime @default(now())
+  updatedAt  DateTime @updatedAt
+  argument   Argument @relation(fields: [argumentId], references: [id])
+  user       User     @relation(fields: [userId], references: [id])
+
+  @@id([userId, argumentId])
+}
+
+// model Representative {
+//   id        Int       @id @default(autoincrement())
+//   userId    Int
+//   sourceId  Int
+//   createdAt DateTime  @default(now())
+//   source    Source    @relation(fields: [sourceId], references: [id])
+//   user      User      @relation(fields: [userId], references: [id])
+
+//   @@unique([sourceId, userId])
+// }
+
+model Source {
+  id              Int               @id @default(autoincrement())
+  domain          String            @unique
+  score           Float             @default(50.0)
+  createdAt       DateTime          @default(now())
+  updatedAt       DateTime          @updatedAt
+  arguments       Argument[]
+  assertions      Assertion[]
+  users           User[]
+}
+
+model User {
+  id              Int               @id @default(autoincrement())
+  name            String
+  email           String            @unique
+  passwordHash    String
+  role            UserRole          @default(USER)
+  createdAt       DateTime          @default(now())
+  updatedAt       DateTime          @updatedAt
+  assertions      Assertion[]
+  arguments       Argument[]
+  ratings         Rating[]
+  sources         Source[]
+}
+
+enum UserRole {
+  SUPERADMIN
+  ADMIN
+  USER
+}
```


