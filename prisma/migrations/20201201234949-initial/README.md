# Migration `20201201234949-initial`

This migration has been generated by https://github.com/DaveLampton at 12/1/2020, 3:49:49 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "User" (
"id" SERIAL,
    "name" TEXT NOT NULL,
    "email" TEXT NOT NULL,
    "password" TEXT NOT NULL,
    "role" "UserRole" NOT NULL DEFAULT E'USER',
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Rating" (
"id" SERIAL,
    "userId" INTEGER NOT NULL,
    "argumentId" INTEGER NOT NULL,
    "rating" BOOLEAN NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Argument" (
"id" SERIAL,
    "assertionId" INTEGER NOT NULL,
    "text" TEXT NOT NULL,
    "userId" INTEGER NOT NULL,
    "sourceId" INTEGER NOT NULL,
    "score" INTEGER NOT NULL DEFAULT 50,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Source" (
"id" SERIAL,
    "domain" TEXT NOT NULL,
    "score" INTEGER NOT NULL DEFAULT 50,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Representative" (
"id" SERIAL,
    "sourceId" INTEGER NOT NULL,
    "userId" INTEGER NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Assertion" (
"id" SERIAL,
    "text" TEXT NOT NULL,
    "userId" INTEGER NOT NULL,
    "sourceId" INTEGER NOT NULL,
    "score" INTEGER NOT NULL DEFAULT 50,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "_SourceToUser" (
    "A" INTEGER NOT NULL,
    "B" INTEGER NOT NULL
)

CREATE UNIQUE INDEX "User.email_unique" ON "User"("email")

CREATE UNIQUE INDEX "Rating.userId_argumentId_unique" ON "Rating"("userId", "argumentId")

CREATE UNIQUE INDEX "Source.domain_unique" ON "Source"("domain")

CREATE UNIQUE INDEX "Representative.userId_sourceId_unique" ON "Representative"("userId", "sourceId")

CREATE UNIQUE INDEX "_SourceToUser_AB_unique" ON "_SourceToUser"("A", "B")

CREATE INDEX "_SourceToUser_B_index" ON "_SourceToUser"("B")

ALTER TABLE "Rating" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Rating" ADD FOREIGN KEY("argumentId")REFERENCES "Argument"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Argument" ADD FOREIGN KEY("assertionId")REFERENCES "Assertion"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Argument" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Argument" ADD FOREIGN KEY("sourceId")REFERENCES "Source"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Representative" ADD FOREIGN KEY("sourceId")REFERENCES "Source"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Representative" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Assertion" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Assertion" ADD FOREIGN KEY("sourceId")REFERENCES "Source"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_SourceToUser" ADD FOREIGN KEY("A")REFERENCES "Source"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_SourceToUser" ADD FOREIGN KEY("B")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201201234949-initial
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,93 @@
+// This is your Prisma schema file,
+// learn more about it in the docs: https://pris.ly/d/prisma-schema
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+generator client {
+  provider = "prisma-client-js"
+}
+
+model User {
+  id            Int         @id @default(autoincrement())
+  name          String
+  email         String      @unique
+  password      String
+  role          UserRole    @default(USER)
+  assertions    Assertion[]
+  arguments     Argument[]
+  ratings       Rating[]
+  represents    Source[]
+  createdAt     DateTime    @default(now())
+  updatedAt     DateTime    @updatedAt
+}
+
+model Rating {
+  id            Int         @id @default(autoincrement())
+  user          User        @relation(fields: [userId], references: [id])
+  userId        Int
+  argument      Argument    @relation(fields: [argumentId], references: [id])
+  argumentId    Int
+  rating        Boolean
+  createdAt     DateTime    @default(now())
+  updatedAt     DateTime    @updatedAt
+
+  @@unique([userId, argumentId])
+}
+
+model Argument {
+  id            Int         @id @default(autoincrement())
+  assertion     Assertion   @relation(fields: [assertionId], references: [id])
+  assertionId   Int
+  text          String
+  contributor   User        @relation(fields: [userId], references: [id])
+  userId        Int
+  source        Source      @relation(fields: [sourceId], references: [id])
+  sourceId      Int
+  score         Int         @default(50)
+  ratings       Rating[]
+  createdAt     DateTime    @default(now())
+  updatedAt     DateTime    @updatedAt
+}
+
+model Source {
+  id              Int       @id @default(autoincrement())
+  domain          String    @unique
+  score           Int       @default(50)
+  representatives User[]
+  createdAt       DateTime  @default(now())
+  updatedAt       DateTime  @updatedAt
+}
+
+model Representative {
+  id            Int         @id @default(autoincrement())
+  source        Source      @relation(fields: [sourceId], references: [id])
+  sourceId      Int
+  user          User        @relation(fields: [userId], references: [id])
+  userId        Int
+  createdAt     DateTime    @default(now())
+  updatedAt     DateTime    @updatedAt
+
+  @@unique([userId, sourceId])
+}
+
+model Assertion {
+  id            Int         @id @default(autoincrement())
+  text          String
+  contributor   User        @relation(fields: [userId], references: [id])
+  userId        Int
+  source        Source      @relation(fields: [sourceId], references: [id])
+  sourceId      Int
+  score         Int         @default(50)
+  arguments     Argument[]
+  createdAt     DateTime    @default(now())
+  updatedAt     DateTime    @updatedAt
+}
+
+enum UserRole {
+  SUPERADMIN
+  ADMIN
+  USER
+}
```


