# Migration `20201202020743-initial`

This migration has been generated by https://github.com/DaveLampton at 12/1/2020, 6:07:43 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."UserRole" AS ENUM ('SUPERADMIN', 'ADMIN', 'USER')

CREATE TABLE "Argument" (
"id" SERIAL,
    "assertionId" INTEGER NOT NULL,
    "text" TEXT NOT NULL,
    "userId" INTEGER NOT NULL,
    "sourceId" INTEGER NOT NULL,
    "score" INTEGER NOT NULL DEFAULT 50,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Assertion" (
"id" SERIAL,
    "text" TEXT NOT NULL,
    "userId" INTEGER NOT NULL,
    "sourceId" INTEGER NOT NULL,
    "score" INTEGER NOT NULL DEFAULT 50,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Rating" (
"id" SERIAL,
    "userId" INTEGER NOT NULL,
    "argumentId" INTEGER NOT NULL,
    "rating" BOOLEAN NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Representative" (
"id" SERIAL,
    "sourceId" INTEGER NOT NULL,
    "userId" INTEGER NOT NULL,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "Source" (
"id" SERIAL,
    "domain" TEXT NOT NULL,
    "score" INTEGER NOT NULL DEFAULT 50,
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE TABLE "User" (
"id" SERIAL,
    "name" TEXT NOT NULL,
    "email" TEXT NOT NULL,
    "password" TEXT NOT NULL,
    "role" "UserRole" NOT NULL DEFAULT E'USER',
    "createdAt" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "updatedAt" TIMESTAMP(3) NOT NULL,

    PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "Rating.userId_argumentId_unique" ON "Rating"("userId", "argumentId")

CREATE UNIQUE INDEX "Representative.userId_sourceId_unique" ON "Representative"("userId", "sourceId")

CREATE UNIQUE INDEX "Source.domain_unique" ON "Source"("domain")

CREATE UNIQUE INDEX "User.email_unique" ON "User"("email")

ALTER TABLE "Argument" ADD FOREIGN KEY("assertionId")REFERENCES "Assertion"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Argument" ADD FOREIGN KEY("sourceId")REFERENCES "Source"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Argument" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Assertion" ADD FOREIGN KEY("sourceId")REFERENCES "Source"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Rating" ADD FOREIGN KEY("argumentId")REFERENCES "Argument"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Rating" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Representative" ADD FOREIGN KEY("sourceId")REFERENCES "Source"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Representative" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration ..20201202020743-initial
--- datamodel.dml
+++ datamodel.dml
@@ -1,0 +1,90 @@
+generator client {
+  provider = "prisma-client-js"
+}
+
+datasource db {
+  provider = "postgresql"
+  url = "***"
+}
+
+model Argument {
+  id          Int       @id @default(autoincrement())
+  assertionId Int
+  text        String
+  userId      Int
+  sourceId    Int
+  score       Int       @default(50)
+  createdAt   DateTime  @default(now())
+  updatedAt   DateTime  @updatedAt
+  assertion   Assertion @relation(fields: [assertionId], references: [id])
+  source      Source    @relation(fields: [sourceId], references: [id])
+  user        User      @relation(fields: [userId], references: [id])
+  ratings     Rating[]
+}
+
+model Assertion {
+  id        Int        @id @default(autoincrement())
+  text      String
+  userId    Int
+  sourceId  Int
+  score     Int        @default(50)
+  createdAt DateTime   @default(now())
+  updatedAt DateTime   @updatedAt
+  source    Source     @relation(fields: [sourceId], references: [id])
+  arguments Argument[]
+}
+
+model Rating {
+  id         Int      @id @default(autoincrement())
+  userId     Int
+  argumentId Int
+  rating     Boolean
+  createdAt  DateTime @default(now())
+  updatedAt  DateTime @updatedAt
+  argument   Argument @relation(fields: [argumentId], references: [id])
+  user       User     @relation(fields: [userId], references: [id])
+
+  @@unique([userId, argumentId], name: "Rating.userId_argumentId_unique")
+}
+
+model Representative {
+  id        Int       @id @default(autoincrement())
+  sourceId  Int
+  userId    Int
+  createdAt DateTime  @default(now())
+  updatedAt DateTime  @updatedAt
+  source    Source    @relation(fields: [sourceId], references: [id])
+  user      User      @relation(fields: [userId], references: [id])
+
+  @@unique([userId, sourceId], name: "Representative.userId_sourceId_unique")
+}
+
+model Source {
+  id              Int               @id @default(autoincrement())
+  domain          String            @unique
+  score           Int               @default(50)
+  createdAt       DateTime          @default(now())
+  updatedAt       DateTime          @updatedAt
+  arguments       Argument[]
+  assertions      Assertion[]
+  representatives Representative[]
+}
+
+model User {
+  id              Int               @id @default(autoincrement())
+  name            String
+  email           String            @unique
+  password        String
+  role            UserRole          @default(USER)
+  createdAt       DateTime          @default(now())
+  updatedAt       DateTime          @updatedAt
+  arguments       Argument[]
+  ratings         Rating[]
+  representatives Representative[]
+}
+
+enum UserRole {
+  SUPERADMIN
+  ADMIN
+  USER
+}
```


